<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Corporacion Life</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.css">
    <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>
    <style>
        body {
            padding-top: 60px;
        }
        .navbar-brand {
            background-image: url('/assets/images/extranet/clife-logo-light.png');
            background-size: auto 30px;
            background-repeat: no-repeat;
            padding-left: 36px;
            font-size: 1.5rem;
            line-height: 1.75rem;
            height: 30px;
            width: 224px;
        }
        .ip-cant {
            width: 60px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-cprimary">
        <a class="navbar-brand" href="#">Corporacion Life</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <h5 class="text-light font-weight-light mb-0">Pedido <span class="font-weight-normal sp-pedido">O119-123123</span></h5>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="nav-dropdown" role="button" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">Opciones</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="nav-dropdown">
                        <a class="dropdown-item" href="#">Mis datos</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modal-logout">Cerrar sesión</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="row d-lg-none">
            <div class="col">
                <h3 class="mb-3">Pedido N° <span class="font-italic text-primary sp-pedido">O119-12559</span></h3>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-auto">
                <div class="alert bg-light">
                    <h5 class="font-weight-light mb-2">Cliente: <span class="font-weight-normal" id="nombre-cliente"></span></h5>
                    <!-- -->
                    <a href="#" class="btn btn-primary m-1 dropdown-toggle" id="btn-agregar" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-plus"></i> Agregar productos</a>
                    <div class="dropdown-menu" aria-labelledby="btn-agregar">
                        <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modal-lista"><i class="fa fa-list"></i> Desde el catálogo de productos</a>
                        <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modal-plantilla"><i class="fa fa-upload"></i> Utilizando una plantilla</a>
                    </div>
                    <a href="#" class="btn btn-danger m-1" id="btn-eliminar"><i class="fa fa-remove"></i> Quitar productos</a>
                    <a href="#" class="btn btn-success ml-5 mr-1" data-toggle="modal" data-target="#modal-cierre"><i class="fa fa-check"></i> Cerrar pedido</a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col" id="container"></div>
        </div>
    </div>
    <!-- modals -->
    <!-- modal logout -->
    <div id="modal-logout" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">Cerrar sesión</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>¿Desea cerrar la sesión? Tendrá que ingresar sus credenciales nuevamente la próxima vez</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancelar</button>
                    <a href="/extranet/logout" class="btn btn-danger">Cerrar sesión</a>
                </div>
            </div>
        </div>
    </div>
    <!-- modal lista-productos -->
    <div id="modal-lista" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-primary">Agregar Productos</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>A continuación, seleccione los productos que desea agregar al pedido</p>
                    <div class="row">
                        <div class="col" id="lista-container"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary"><i class="fa fa-plus"></i> Agregar los productos</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal plantilla -->
    <div id="modal-plantilla" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success">Carga masiva</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="fl-plantilla">Adjunte una plantilla en formato xls para agregar productos de manera masiva.</label>
                            <input type="file" class="form-control-file" id="fl-plantilla" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                        </div>
                        <div class="form-group">
                            <p class="text-dark">Puede descargar una plantilla de muestra haciendo clic en el <a href="#">siguiente enlace</a>.</p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success"><i class="fa fa-upload"></i> Enviar plantilla</button>
                </div>
            </div>
        </div>
    </div><!-- modal plantilla -->
    <div id="modal-cierre" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success">Cierre del pedido</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="text-dark mb-2">A continuación, le mostramos el resumen de su pedido</p>
                    <form>
                        <div class="form-group row mb-0">
                            <label for="rp-items" class="col-sm-3 col-form-label text-right pr-2">Nro. items</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control-plaintext font-weight-bold" id="rp-items">
                            </div>
                        </div>
                        <div class="form-group row mb-0">
                            <label for="rp-subtotal" class="col-sm-3 col-form-label text-right pr-2">Subtotal</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control-plaintext font-weight-bold" id="rp-subtotal">
                            </div>
                        </div>
                        <div class="form-group row mb-0">
                            <label for="rp-cajas" class="col-sm-3 col-form-label text-right pr-2">Cajas</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control-plaintext font-weight-bold" id="rp-cajas">
                            </div>
                        </div>
                        <div class="form-group row mb-0">
                            <label for="rp-pallets" class="col-sm-3 col-form-label text-right pr-2">Pallets</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control-plaintext font-weight-bold" id="rp-pallets">
                            </div>
                        </div>
                    </form>
                    <p class="text-dark mb-2">Si ya no desea agregar más items, utilice el botón de <span class="text-success font-weight-bold">Cerrar el pedido</span>, y procesaremos su solicitud lo más pronto posible.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success"><i class="fa fa-check"></i> Cerrar el pedido</button>
                </div>
            </div>
        </div>
    </div>
    <!-- scripts -->
    <script src="/assets/vendor/jquery/jquery-3.2.1.min.js"></script>
    <script src="/assets/bootstrap/js/popper.min.js"></script>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script>
        let sesdata = JSON.parse('<%-sesion %>');
        let Pedido = {
            codigo: 'O119-12559',
            moneda: 'US$',
            subtotal: 16588.12,
            productos: []
        };
        let Cliente = {
            rucdni: 10305760066,
            nombre: 'Hogarama SA'
        };
        let catalogo = [];
        let totales = {
            cantidad: 0,
            cajas: 0,
            pallets: 0,
            importe: 0
        };
        let DetallePedido = Pedido.productos;
        /*let DetallePedido = [
            { codigo: '00001000201087', ean: '7756719002905', nombre: 'Tinte para cabello For Men PACK x 35 ml .03 de 6 und. Cast.Oscuro', cantidad: 96, cajas: 8, pallets: 0.14, importe: 202.0896 , difer: 1, tipo: 'L' },
            { codigo: '01020005000022', ean: '7756719004527', nombre: 'Shock Anticaida Radiant x 15ml Caj.x 12 und. V2', cantidad: 120, cajas: 10, pallets: 0.2, importe: 100.68 , difer: 1, tipo: 'L' },
            { codigo: '01020005100059', ean: '7756719004534', nombre: 'Shock Reparacion Intensa Radiant x 15ml Caj.x 12 und. V2', cantidad: 24, cajas: 2, pallets: 0.08, importe: 201.36 , difer: 1, tipo: 'C' },
            { codigo: '03023013000006', ean: '7756719007573', nombre: 'Laca Ultrafix PLife Saloon Fco x 175 ml', cantidad: 36, cajas: 3, pallets: 0.13, importe: 38.37 , difer: 1, tipo: 'L' },
            { codigo: '03023013100019', ean: '7756719002745', nombre: 'Gel Efec. Mojado P.Life Saloon tubo x 200 gr.', cantidad: 72, cajas: 6, pallets: 0.12, importe: 34.86 , difer: 1, tipo: 'P' },
            { codigo: '03024015100010', ean: '7756719007580', nombre: 'Crema para peinar PLife Saloon Fco x 250 ml', cantidad: 60, cajas: 5, pallets: 0.02, importe: 83.28 , difer: 1, tipo: 'N' },
            { codigo: '03024015200003', ean: '7756719002684', nombre: 'Cera Moldeadora P.Life Saloon x Pote 50gr.7756719002684', cantidad: 84, cajas: 7, pallets: 0.18, importe: 58.95 , difer: 1, tipo: 'L' }
        ];*/
        // funciones
        AdjuntarPlantilla = (event) => {
            event.preventDefault();
            const button = $('#modal-plantilla .modal-footer .btn-success').empty().html('Procesando la plantilla...');
            button.prop('disabled', true);
            setTimeout(() => {
                button.prop('disabled', false).empty().append(
                    $('<i>').addClass('fa fa-upload')
                ).append(' Enviar plantilla');
                $('#modal-plantilla').modal('hide');
                alert('Los productos fueron cargados con éxito');
                // agrega los productos y recarga la grilla
                DetallePedido.push({ codigo: '03025015400014', ean: '7756719003377', nombre: 'Silicona Plife Saloon Fco. 80ml.', cantidad: 3, cajas: 1, pallets: 0.12, importe: 49.0863, difer: 1, tipo: 'L' });
                DetallePedido.push({ codigo: '04026016000008', ean: '7756719004299', nombre: 'Shampoo Pl Life Be Natural Nutri Quinua Fco x 350ml', cantidad: 3, cajas: 1, pallets: 0.12, importe: 45.2419, difer: 1, tipo: 'L' });
                DetallePedido.push({ codigo: '04026016000009', ean: '7756719004367', nombre: 'Shampoo Pl Life Be Natural Nutri Quinua Fco x 1L', cantidad: 3, cajas: 1, pallets: 0.12, importe: 103.3489, difer: 1, tipo: 'L' });
                DetallePedido.push({ codigo: '04026016200020', ean: '7756719004282', nombre: 'Shampoo Pl Life Be Natural Repair Argan Fco x 350ml', cantidad: 3, cajas: 1, pallets: 0.12, importe: 45.2419, difer: 1, tipo: 'L' });
                DetallePedido.push({ codigo: '04026016200021', ean: '7756719004350', nombre: 'Shampoo Pl Life Be Natural Repair Argan Fco x 1L', cantidad: 3, cajas: 1, pallets: 0.12, importe: 103.3489, difer: 1, tipo: 'C' });
                DetallePedido.push({ codigo: '04026016200023', ean: '7756719004374', nombre: 'Shampoo Placenta Life Lisso Keratina Fco x 1l', cantidad: 3, cajas: 1, pallets: 0.12, importe: 103.3489, difer: 1, tipo: 'P' });
                DetallePedido.push({ codigo: '04026016200024', ean: '7756719004305', nombre: 'Shampoo Placenta Life Hydra Macadamia Fco x 350ml', cantidad: 3, cajas: 1, pallets: 0.12, importe: 45.2419, difer: 1, tipo: 'L' });
                EscribirListaProductos();
            }, 3000);
        }
        EscribirListaProductos = () => {
            $('#container').empty();
            if (DetallePedido.length > 0) {
                let tbody = $('<tbody>');
                totales = {
                    cantidad: 0,
                    cajas: 0,
                    pallets: 0,
                    importe: 0
                };
                for (let i in DetallePedido) {
                    let producto = DetallePedido[i];
                    let btnTipo = $('<a>').attr('href', 'javascript:void(0)').addClass('btn btn-sm').html(producto.tipo);
                    switch (producto.tipo) {
                        case 'L': btnTipo.addClass('btn-success').attr('title', 'Precio de lista'); break;
                        case 'C': btnTipo.addClass('btn-info').attr('title', 'Producto complementario'); break;
                        case 'P': btnTipo.addClass('btn-danger').attr('title', 'Producto promocional'); break;
                        case 'N': btnTipo.addClass('btn-warning').attr('title', 'Precio normal'); break;
                        default: btnTipo.addClass('btn-light'); break;
                    }
                    tbody.append(
                        $('<tr>').append(
                            $('<td>').append(
                                $('<input>').attr({
                                    type: 'checkbox',
                                    name: 'productos[]',
                                    value: producto.codigo,
                                    'data-key': i
                                }).prop('checked', false).addClass('ch-producto')
                            )
                        ).append(
                            $('<td>').append(
                                $('<a>').attr('href', 'javascript:void(0)').addClass('btn btn-primary btn-sm').html(producto.ean)
                            )
                        ).append(
                            $('<td>').append(btnTipo)
                        ).append(
                            $('<td>').html(producto.nombre)
                        ).append(
                            $('<td>').html(producto.cantidad.toLocaleString('en-us', { minimumFractionDigits: 0, maximumFractionDigits: 0 })).addClass('text-right')
                        ).append(
                            $('<td>').html(producto.cajas.toLocaleString('en-us', { minimumFractionDigits: 0, maximumFractionDigits: 0 })).addClass('text-right')
                        ).append(
                            $('<td>').html(producto.pallets.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 })).addClass('text-right')
                        ).append(
                            $('<td>').html(producto.importe.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 })).addClass('text-right')
                        )
                    );
                    totales.cantidad += producto.cantidad;
                    totales.cajas += producto.cajas;
                    totales.pallets += producto.pallets;
                    totales.importe += producto.importe;
                }
                $('#container').append(
                    $('<table>').append(
                        $('<thead>').append(
                            $('<tr>').append(
                                $('<th>').html('')
                            ).append(
                                $('<th>').html('Cod. EAN')
                            ).append(
                                $('<th>').html('Tipo')
                            ).append(
                                $('<th>').html('Nombre')
                            ).append(
                                $('<th>').html('Cantidad')
                            ).append(
                                $('<th>').html('Cajas')
                            ).append(
                                $('<th>').html('Pallets')
                            ).append(
                                $('<th>').html('Importe')
                            )
                        )
                    ).append(tbody).append(
                        $('<tfoot>').append(
                            $('<tr>').append(
                                $('<th>').html('')
                            ).append(
                                $('<th>').html('')
                            ).append(
                                $('<th>').html('')
                            ).append(
                                $('<th>').html('TOTALES')
                            ).append(
                                $('<th>').html(totales.cantidad.toLocaleString('en-us', { minimumFractionDigits: 0, maximumFractionDigits: 0 })).addClass('text-right')
                            ).append(
                                $('<th>').html(totales.cajas.toLocaleString('en-us', { minimumFractionDigits: 0, maximumFractionDigits: 0 })).addClass('text-right')
                            ).append(
                                $('<th>').html(totales.pallets.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 })).addClass('text-right')
                            ).append(
                                $('<th>').html(Pedido.moneda + ' ' + totales.importe.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 })).addClass('text-right')
                            )
                        )
                    ).addClass('table table-hover table-striped table-responsive')
                );
            }
            else {
                $('#container').empty().append(
                    $('<p>').addClass('mb-0').html('Aún no ha agregado productos para su pedido')
                );
            }
        }
        function IngresarCantidad(event) {
            let ds = event.target.dataset;
            let idx = parseInt(ds.idx);
            let pventa = parseFloat(ds.pventa);
            let caja = parseInt(ds.caja);
            let pcaja = parseFloat(ds.pcaja);
            let stock = parseInt(ds.stock);
            let cantidad = parseInt($(this).val());
            // validaciones
            let resto = cantidad % caja;
            let cajas = Math.floor(cantidad / caja);
            if (cantidad > stock) {
                cantidad = stock;
                $(this).val(stock);
                document.getElementById('alert-' + idx).innerHTML = 'Stock superado';
            }
            else {
                if (resto > 0) {
                    cajas += 1;
                    let faltante = cajas * caja;
                    document.getElementById('alert-' + idx).innerHTML = faltante + ' para ' + cajas + ' caja(s)';
                }
                else {
                    document.getElementById('alert-' + idx).innerHTML = '';
                }
            }
            let subtotal = cantidad * pventa;
            let pallets = cajas * pcaja;
            // actualiza array
            catalogo[idx].cantidad = cantidad;
            catalogo[idx].subtotal = subtotal;
            catalogo[idx].cajas = cajas;
            catalogo[idx].pallets = pallets;
            //
            document.getElementById('subtotal-' + idx).innerHTML = subtotal.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('pallets-' + idx).innerHTML = pallets.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 });;
        }
        CargarCatalogoProductos = (event) => {
            $('#lista-container').empty();
            catalogo = [
                { codigo: '04026016200030', ean: '7756719007641', nombre: 'Shampoo Extra Hidratante Ls Plife Saloon Fco X 400 Ml', pventa: 11.8588, caja: 12, pcaja: 0.1, stock: 1500, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04026016200035', ean: '7756719007979', nombre: 'Shampoo Reparación Intensa Ls Plife Saloon Fco X 400 Ml', pventa: 11.8588, caja: 10, pcaja: 0.09, stock: 1060, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04026016300043', ean: '7756719007566', nombre: 'Shampoo Brillo Intenso  Plife  Saloon Fco X400 Ml', pventa: 11.8588, caja: 10, pcaja: 0.03, stock: 780, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04026016300050', ean: '7756719012256', nombre: 'Shampoo Efecto Brasilero Con Keratina Tonno Plus X 400 Ml ', pventa: 14.3224, caja: 12, pcaja: 0, stock: 640, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04026016400008', ean: '7756719007962', nombre: 'Shampoo Anticaspa 2 En 1 Plife Saloon Fco X 400 Ml', pventa: 11.8588, caja: 10, pcaja: 0.01, stock: 1540, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04026016500011', ean: '7756719011778', nombre: 'Pl Be Natural Vital Placenta Shampoo X 350Ml', pventa: 15.0806, caja: 12, pcaja: 0.15, stock: 1320, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04026016500012', ean: '7756719011815', nombre: 'Pl Be Natural Blue Berry Silver Shampoo X 350Ml', pventa: 22.5, caja: 10, pcaja: 0.03, stock: 1040, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020100026', ean: '7756719004312', nombre: 'Condition Placenta Life Repair Argan Fco X 350Ml', pventa: 15.0806, caja: 10, pcaja: 0.07, stock: 1620, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020100027', ean: '7756719004398', nombre: 'Condition Pl Life Be Natural  Repair Argan Fco X 1L', pventa: 34.4496, caja: 12, pcaja: 0.03, stock: 1260, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020100029', ean: '7756719004411', nombre: 'Condition Placenta Life Lisso Keratina Fco X 1L', pventa: 34.4496, caja: 10, pcaja: 0.06, stock: 1360, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020100030', ean: '7756719004343', nombre: 'Condition Placenta Life Hydra Macadamia  Fco X 350Ml', pventa: 15.0806, caja: 10, pcaja: 0.05, stock: 1220, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020100031', ean: '7756719004428', nombre: 'Condition Placenta Life Hydra Macadamia  Fco X 1L', pventa: 34.4496, caja: 12, pcaja: 0.2, stock: 1300, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020200008', ean: '7756719012263', nombre: 'Conditioner Efecto Brasilero Con Keratina Tonno Plus X 400 Ml', pventa: 14.3224, caja: 12, pcaja: 0.01, stock: 400, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020300008', ean: '7756719004329', nombre: 'Condition Placenta Life Nutri Quinua Fco X 350Ml', pventa: 15.0806, caja: 12, pcaja: 0.02, stock: 260, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020300009', ean: '7756719004404', nombre: 'Condition Placenta Life Nutri Quinua Fco X 1L', pventa: 34.4496, caja: 10, pcaja: 0.06, stock: 780, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020400012', ean: '7756719011785', nombre: 'Pl Be Natural Vital Placenta Conditioner X 350Ml', pventa: 15.0806, caja: 12, pcaja: 0.01, stock: 480, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '04027020400013', ean: '7756719011822', nombre: 'Pl Be Natural Blueberry Silver Conditioner X 350Ml', pventa: 22.5, caja: 10, pcaja: 0.2, stock: 940, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '08095090000008', ean: '7756719012447', nombre: 'Plife Saloon Shampoo Control Caída Fco X 400Ml', pventa: 11.8633, caja: 12, pcaja: 0.13, stock: 820, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '08095090200010', ean: '7756719012454', nombre: 'Plife Saloon Conditioner Control Caída Fco X 400Ml', pventa: 11.8633, caja: 12, pcaja: 0.2, stock: 1580, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '08095090200011', ean: '7756719012461', nombre: 'Plife Saloon Conditioner Brillo Intenso Fco X 400Ml', pventa: 11.8633, caja: 12, pcaja: 0.14, stock: 560, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '08095090200012', ean: '7756719012478', nombre: 'Plife Saloon Conditioner Reparación Intensa Fco X 400Ml', pventa: 11.8633, caja: 10, pcaja: 0.1, stock: 1800, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '08095090300358', ean: '7756719017411', nombre: 'Plife Saloon Decoloración Ultra Pote 500G', pventa: 40.6897, caja: 12, pcaja: 0.11, stock: 1480, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 },
                { codigo: '11098009900001', ean: '7756719011839', nombre: 'Pl Keratimask Kit Alisado Brasileño', pventa: 38.814, caja: 10, pcaja: 0.02, stock: 300, cantidad: 0, subtotal: 0, cajas: 0, pallets: 0 }
            ];
            //
            let tbody = $('<tbody>');
            for (let j in catalogo) {
                let item = catalogo[j];
                tbody.append(
                    $('<tr>').append(
                        $('<td>').html(item.ean)
                    ).append(
                        $('<td>').html(item.nombre)
                    ).append(
                        $('<td>').html(item.pventa).addClass('text-right')
                    ).append(
                        $('<td>').html(item.stock).addClass('text-right')
                    ).append(
                        $('<td>').html(item.caja).addClass('text-right')
                    ).append(
                        $('<td>').append(
                            $('<input>').attr({
                                type: 'text',
                                id: 'cnt-' + j,
                                'data-idx': j,
                                'data-pventa': item.pventa,
                                'data-caja': item.caja,
                                'data-pcaja': item.pcaja,
                                'data-stock': item.stock
                            }).addClass('form-control form-control-sm ip-cant').on('keyup', IngresarCantidad)
                        ).append(
                            $('<small>').attr('id', 'alert-' + j).addClass('text-danger')
                        )
                    ).append(
                        $('<td>').append(
                            $('<span>').attr('id', 'subtotal-' + j).html('0')
                        ).addClass('text-right')
                    ).append(
                        $('<td>').append(
                            $('<span>').attr('id', 'pallets-' + j).html('0')
                        ).addClass('text-right')
                    )
                );
            }
            $('#lista-container').append(
                $('<table>').append(
                    $('<thead>').append(
                        $('<tr>').append(
                            $('<th>').html('EAN')
                        ).append(
                            $('<th>').html('Producto')
                        ).append(
                            $('<th>').html('P.Venta')
                        ).append(
                            $('<th>').html('Stock')
                        ).append(
                            $('<th>').html('Unids/ Caja')
                        ).append(
                            $('<th>').html('Cantidad')
                        ).append(
                            $('<th>').html('Subtotal')
                        ).append(
                            $('<th>').html('Pallets')
                        )
                    )
                ).append(tbody).addClass('table table-hover table-striped')
            );
        }
        EliminarProductos = (event) => {
            event.preventDefault();
            let eliminar = [];
            if (window.confirm('¿Eliminar los productos seleccionados?')) {
                let productos = $('.ch-producto:checked');
                $.each(productos, function() {
                    let chbox = $(this);
                    eliminar.push(parseInt(chbox.data('key')));
                });
                eliminar.sort();
                eliminar.reverse();
                for (let i of eliminar) DetallePedido.splice(i, 1);
                EscribirListaProductos();
            }
        }
        AgregarProductos = (event) => {
            event.preventDefault();
            const boton = $('#modal-lista .modal-footer .btn-primary');
            boton.prop('disabled', true).empty().html('Procesando su pedido...');
            for (let item of catalogo) {
                if (item.cantidad > 0) {
                    DetallePedido.push({
                        codigo: item.codigo,
                        ean: item.ean,
                        nombre: item.nombre,
                        cantidad: item.cantidad,
                        cajas: item.cajas,
                        pallets: item.pallets,
                        importe: item.subtotal,
                        difer: 1,
                        tipo: 'L'
                    });
                }
            }
            setTimeout(() => {
                $('#modal-lista').modal('hide');
                EscribirListaProductos();
                alert('Se agregaron los productos');
                boton.prop('disabled', false).empty().append(
                    $('<i>').addClass('fa fa-plus')
                ).append(' Agregar los productos');
            }, 3000);
        }
        ResumenPedido = (event) => {
            document.getElementById('rp-items').value = totales.cantidad.toLocaleString('en-us', { minimumFractionDigits:0, maximumFractionDigits: 0 });
            document.getElementById('rp-subtotal').value = Pedido.moneda + ' ' + totales.importe.toLocaleString('en-us', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('rp-cajas').value = totales.cajas.toLocaleString('en-us', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('rp-pallets').value = totales.pallets.toLocaleString('en-us', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }
        CerrarPedido = (event) => {
            event.preventDefault();
            const boton = $('#modal-cierre .modal-footer .btn-success');
            boton.prop('disabled', true);
            boton.empty().html('Procesando. Por favor, espere...');
            setTimeout(() => {
                boton.prop('disabled', false).empty().append(
                    $('<i>').addClass('fa fa-check')
                ).append(' Cerrar el pedido');
                $('#modal-cierre').modal('hide');
                alert('¡Su pedido ha sido enviado!');
                location.href = '/extranet';
            }, 1500);
        }
        // iniciar la interfaz
        $('.sp-pedido').html(Pedido.codigo);
        document.getElementById('nombre-cliente').innerHTML = Cliente.nombre;
        EscribirListaProductos();
        $('#btn-eliminar').on('click', EliminarProductos);
        $('#modal-plantilla .modal-footer .btn-success').on('click', AdjuntarPlantilla);
        $('#modal-lista').on('show.bs.modal', CargarCatalogoProductos);
        $('#modal-lista .modal-footer .btn-primary').on('click', AgregarProductos);
        $('#modal-cierre').on('show.bs.modal', ResumenPedido);
        $('#modal-cierre .modal-footer .btn-success').on('click', CerrarPedido);
    </script>
</body>

</html>